{% extends 'dashboards/base_dashboard.html' %}
{% block title %}Leave Requests — Shift Manager{% endblock %}
{% block dashboard_content %}
<div class="bg-white p-6 rounded shadow">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold">Leave Requests</h1>
    <a href="{% url 'shifts:leave_create' %}" class="px-3 py-2 bg-blue-600 text-white rounded">New Request</a>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    {% for leave in leave_requests %}
      <div class="p-4 border rounded-lg bg-white flex flex-col justify-between h-full">
        <div>
          <div class="text-sm text-gray-600">{{ leave.requester.get_full_name|default:leave.requester.username }} • {{ leave.created_at|date:"Y-m-d H:i" }}</div>
          <div class="font-medium mt-2">{{ leave.start_datetime|date:"Y-m-d H:i" }} → {{ leave.end_datetime|date:"Y-m-d H:i" }}</div>
          <div class="text-sm text-gray-700 mt-3">{{ leave.reason|linebreaksbr }}</div>
        </div>
        <div class="mt-4 flex items-center justify-between">
          <div class="text-xs text-gray-600">Status: <span class="font-semibold">{{ leave.get_status_display }}</span></div>
          <div class="flex items-center space-x-2">
            {% if user.is_super_admin %}
              <form method="post" action="{% url 'shifts:leave_approve' leave.pk %}" class="flex items-center space-x-2">
                {% csrf_token %}
                <button name="action" value="approve" type="submit" class="px-3 py-1 bg-green-600 text-white rounded">Approve</button>
                <button name="action" value="reject" type="submit" class="px-3 py-1 bg-red-600 text-white rounded">Reject</button>
              </form>
            {% elif user.is_line_manager and leave.requester.line_manager_id == user.id %}
              <form method="post" action="{% url 'shifts:leave_approve' leave.pk %}" class="flex items-center space-x-2">
                {% csrf_token %}
                <button name="action" value="approve" type="submit" class="px-3 py-1 bg-green-600 text-white rounded">Approve</button>
                <button name="action" value="reject" type="submit" class="px-3 py-1 bg-red-600 text-white rounded">Reject</button>
              </form>
            {% endif %}
          </div>
        </div>
        {% if leave.status == 'approved' and leave.reliever_assignment %}
          <div class="mt-3 text-sm text-gray-700">Reliever: {{ leave.reliever_assignment.reliever.get_full_name|default:leave.reliever_assignment.reliever.username }}</div>
        {% endif %}
      </div>
    {% empty %}
      <div class="p-4 text-gray-600">No leave requests found.</div>
    {% endfor %}
  </div>
</div>
{% endblock %}
